<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Máquina</title>
    <link rel="stylesheet" href="./../css/cabecalho3.css">
</head>

<body>
    <!-- Cabeçalho -->
    <div class="total-dash">
        <div class="dashboard-bg">
            <div class="dashboard-sidebar">
                <div class="dashboard-logo"></div>
                <div class="dashboard-sidebar-btns">
                    <a href="alertas.html" class="dashboard-sidebar-btn">
                        <div class="icon-alert"></div>
                        <h3>Alertas</h3>
                    </a>
                    <a href="conta.html" class="dashboard-sidebar-btn">
                        <div class="icon-user"></div>
                        <h3>Conta</h3>
                    </a>
                    <a href="dashboard-alto.html" class="dashboard-sidebar-btn">
                        <div class="icon-dashboard"></div>
                        <h3>Painel de <br> Controle</h3>
                    </a>
                    <a href="suporte.html" class="dashboard-sidebar-btn">
                        <div class="icon-support"></div>
                        <h3>Suporte</h3>
                    </a>
                </div>
                <a href="/public/index.html" class="dashboard-logout">
                    <div class="icon-logout"></div>
                    <h3>Logout</h3>
                </a>
            </div>
            <!-- Cabeçalho topo -->
            <div class="dashboard-low-right-side">
                <div class="dashboard-topbar">
                    <a href="#" class="btn-voltar">
                        Conta - SolarData
                    </a>
                    <div class="btns-topbar">
                        <div class="btn-padrao">
                            <button class="btn-user">
                                Gerenciamento usuario
                            </button>
                            <button class="btn-notificacao">
                            </button>
                            <a href="conta.html" class="btn-conta">
                            </a>
                        </div>
                    </div>
                </div>
                <!-- Fim Cabeçalho -->    
                
            </div>
        </div>
    </div>

    <div id="modalUsuarios" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciamento de Usuários</h2>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="form-adicionar-usuario">
                    <h3>Adicionar Novo Usuário</h3>
                    <form id="formNovoUsuario">
                        <div class="form-group">
                            <label for="email">E-mail:</label>
                            <input type="email" id="email" name="email" required placeholder="exemplo@empresa.com">
                        </div>
                         <div class="form-group">
                            <label for="senha">Senha:</label>
                            <input type="password" id="senha" name="senha" required placeholder="**********">
                        </div>
                        <div class="form-group">
                            <label for="permissao">Tipo de Permissão:</label>
                            <select id="permissao" name="permissao" required>
                                <option value="">Selecione o tipo de permissão...</option>
                                <option value="admin">Administrador</option>
                                <option value="usuario">Usuário</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-adicionar">Adicionar Usuário</button>
                    </form>
                </div>

                <div class="lista-usuarios">
                    <h3>Usuários do Sistema</h3>
                    <div class="tabela-usuarios">
                        <table>
                            <thead>
                                <tr>
                                    <th>E-mail</th>
                                    <th>Tipo de Permissão</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaUsuarios">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="lista-maquinas"></div>

    <div id="modalNotificacoes">
      <div class="modal-content">
        <div id="alertasContainer"></div>
        <button id="btnFecharModal">Fechar</button>
    </div>

    <script>

        document.addEventListener("DOMContentLoaded", () => {

    const btnNotificacao = document.querySelector('.btn-notificacao');
    const modal = document.getElementById('modalNotificacoes');
    const btnFecharModal = document.getElementById('btnFecharModal');
    const alertasContainer = document.getElementById('alertasContainer');
    const listaMaquinas = document.getElementById('lista-maquinas');

    if (!btnNotificacao || !modal || !btnFecharModal || !alertasContainer || !listaMaquinas) {
      console.error("Elementos de alerta/maquinas não encontrados:", {
        btnNotificacao, modal, btnFecharModal, alertasContainer, listaMaquinas
      });
      return;
    }

    const alertasMock = [
      { identificador: "Server-SP01", componenteNome: "CPU", captura: 87.5, estado: "ALERTA CRITICO", dtHora: "2025-10-28T21:05:17" },
      { identificador: "Server-SP02", componenteNome: "RAM", captura: 82.1, estado: "ALERTA PREVENTIVO", dtHora: "2025-10-28T21:03:12" },
      { identificador: "Server-SP03", componenteNome: "DISCO", captura: 91.3, estado: "ALERTA CRITICO", dtHora: "2025-10-28T21:01:45" },
      { identificador: "Server-SP01", componenteNome: "CPU", captura: 68.9, estado: "ALERTA PREVENTIVO", dtHora: "2025-10-28T21:00:32" }
    ];

    const maquinasMock = [
      { HostName: "server-sp01", Identificador: "Server-SP01", IP: "192.168.0.10", DataCriacao: "2025-10-20T10:00:00", UltimoAlerta: "2025-10-28T21:05:17", CPU: 75, RAM: 82 },
      { HostName: "server-sp02", Identificador: "Server-SP02", IP: "192.168.0.11", DataCriacao: "2025-10-22T14:32:00", UltimoAlerta: "2025-10-28T21:03:12", CPU: 45, RAM: 70 },
      { HostName: "server-sp03", Identificador: "Server-SP03", IP: "192.168.0.12", DataCriacao: "2025-10-18T09:21:00", UltimoAlerta: "2025-10-28T21:01:45", CPU: 91, RAM: 76 },
      { HostName: "server-rj01", Identificador: "Server-RJ01", IP: "192.168.1.10", DataCriacao: "2025-10-15T08:00:00", UltimoAlerta: "2025-10-27T19:45:00", CPU: 20, RAM: 25 }
    ];

    function formatarData(iso) {
      if (!iso) return "—";
      const d = new Date(iso);
      if (isNaN(d)) return "—";
      return d.toLocaleString("pt-BR", { day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit" });
    }

    function carregarAlertas() {
      alertasContainer.innerHTML = "";
      if (!alertasMock.length) {
        alertasContainer.innerHTML = "<p class='text-muted text-center'>Nenhum alerta.</p>";
        return;
      }
      alertasMock.forEach(a => {
        const tipoClasse = a.estado == "ALERTA CRITICO" ? "danger" : a.estado == "ALERTA PREVENTIVO" ? "warning" : "success";
        const div = document.createElement("div");
        div.className = `alerta-item ${tipoClasse}`;
        div.innerHTML = `
        <strong>${a.identificador}</strong>
        <small style="display:block;margin-top:4px;">${a.componenteNome} • <b>${a.captura}%</b></small>
        <div style="margin-top:6px;"><small>Estado: <b>${a.estado}</b></small></div>
        <small style="display:block;margin-top:6px;color:#555">${formatarData(a.dtHora)}</small>
      `;
        alertasContainer.appendChild(div);
      });
    }


    

    function carregarMaquinas() {
      listaMaquinas.innerHTML = "";
      maquinasMock.forEach(m => {
        const usoCPU = `${m.CPU}%`, usoRAM = `${m.RAM}%`;
        let estado = "normal";
        if (m.CPU > 80 || m.RAM > 90) estado = "alerta critico";
        else if (m.CPU >= 70 || m.RAM >= 80) estado = "alerta preventivo";
        else if (m.CPU < 10 && m.RAM < 10) estado = "ocioso";

        const linha = document.createElement("div");
        linha.className = "line-notifica";
        linha.innerHTML = `
        <div class="box-id"><p>${m.HostName}</p></div>
        <div class="box-nome"><p>${m.Identificador}</p></div>
        <div class="box-uptime"><p>${m.IP}</p></div>
        <div class="box-uptime"><p>${formatarData(m.DataCriacao)}</p></div>
        <div class="box-ocorrencia"><p>${formatarData(m.UltimoAlerta)}</p></div>
        <div class="box-rack"><p>${usoCPU}</p></div>
        <div class="box-rack"><p>${usoRAM}</p></div>
        <div class="box-status"><p class="status ${estado}">${estado.toUpperCase()}</p></div>
      `;

        linha.addEventListener("click", () => {
          window.location.href = `dashboard.html?id=${encodeURIComponent(m.Identificador)}`;
        });

        listaMaquinas.appendChild(linha);
      });
    }

    btnNotificacao.addEventListener("click", () => {
      console.log("Clicou no botão de notificação");
      modal.classList.add("active");
      carregarAlertas();
    });
    btnFecharModal.addEventListener("click", () => modal.classList.remove("active"));
    modal.addEventListener("click", (e) => { if (e.target === modal) modal.classList.remove("active"); });

    carregarMaquinas();
    console.log("carregarMaquinas() executado — máquinas mockadas exibidas.");
  });









        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('modalUsuarios');
            const btnAbrir = document.querySelector('.btn-user');
            const spanFechar = document.querySelector('.close');
            const formNovoUsuario = document.getElementById('formNovoUsuario');
            const tabelaUsuarios = document.getElementById('tabelaUsuarios');

            let usuarios = [
                { email: 'admin@solardata.com', permissao: 'admin' },
                { email: 'analista1@solardata.com', permissao: 'usuario' },
            ];

            btnAbrir.addEventListener('click', function() {
                modal.style.display = 'block';
                carregarUsuarios();
            });

            spanFechar.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });

            function carregarUsuarios() {
                tabelaUsuarios.innerHTML = '';
                usuarios.forEach((usuario, index) => {
                    const tr = document.createElement('tr');
                    
                    const classePermissao = `permissao-${usuario.permissao}`;
                    const textoPermissao = usuario.permissao === 'admin' ? 'Administrador' : 
                                        usuario.permissao === 'usuario' ? 'Usuário' : 'Visualizador';
                    
                    tr.innerHTML = `
                        <td>${usuario.email}</td>
                        <td><span class="${classePermissao}">${textoPermissao}</span></td>
                        <td>
                            <button class="btn-acao btn-editar" onclick="editarUsuario(${index})">Editar</button>
                            <button class="btn-acao btn-excluir" onclick="excluirUsuario(${index})">Excluir</button>
                        </td>
                    `;
                    tabelaUsuarios.appendChild(tr);
                });
            }

            formNovoUsuario.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const permissao = document.getElementById('permissao').value;
                
                if (email && permissao) {
                    usuarios.push({ email, permissao });
                    carregarUsuarios();
                    formNovoUsuario.reset();
                    
                    console.log('Novo usuário:', { email, permissao });
                    alert('Usuário adicionado com sucesso!');
                }
            });

            window.editarUsuario = function(index) {
                const usuario = usuarios[index];
                const novoEmail = prompt('Editar e-mail:', usuario.email);
                const novaPermissao = prompt('Editar permissão (admin/usuario/visualizador):', usuario.permissao);
                
                if (novoEmail && novaPermissao) {
                    usuarios[index] = { email: novoEmail, permissao: novaPermissao };
                    carregarUsuarios();
                    alert('Usuário atualizado com sucesso!');
                }
            };

            window.excluirUsuario = function(index) {
                if (confirm('Tem certeza que deseja excluir este usuário?')) {
                    usuarios.splice(index, 1);
                    carregarUsuarios();
                    alert('Usuário excluído com sucesso!');
                }
            };

            carregarUsuarios();
        });



    </script>
</body>

</html>