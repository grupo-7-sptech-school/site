<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/logo-branca.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarData | Painel de controle</title>


    <link rel="stylesheet" href="./../css/cabecalho1.css">


    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/dash-alto.css">
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<!-- <body onload=" atualizarFeed()"> -->

<body onload="filtrarCadastroMaquina()">
    <!-- Cabeçalho -->
    <div class="dashboard-bg">
        <div class="dashboard-sidebar">
            <div class="dashboard-logo"></div>
            <div class="dashboard-sidebar-btns">
                <a href="alertas.html" class="dashboard-sidebar-btn">
                    <div class="icon-alert"></div>
                    <h3>Alertas</h3>
                </a>
                <a href="conta.html" class="dashboard-sidebar-btn">
                    <div class="icon-user"></div>
                    <h3>Conta</h3>
                </a>
                <a href="dashboard.html" class="dashboard-sidebar-btn">
                    <div class="icon-dashboard"></div>
                    <h3>Painel de Controle</h3>
                </a>
                <a href="relatorios.html" class="dashboard-sidebar-btn">
                    <div class="icon-relatory"></div>
                    <h3>Relatórios</h3>
                </a>
                <a href="suporte.html" class="dashboard-sidebar-btn">
                    <div class="icon-support"></div>
                    <h3>Suporte</h3>
                </a>
            </div>
            <a href="index.html" class="dashboard-logout">
                <div class="icon-logout"></div>
                <h3>Logout</h3>
            </a>
        </div>
        <!-- Cabeçalho topo -->
        <div class="dashboard-low-right-side">
            <div class="dashboard-topbar">
                <a href="dashboard-alto.html" class="btn-voltar">
                    Painel de controle - Servidor
                </a>
                <div class="btns-topbar">
                    <a id="btnCadsatrarMaquina" href="cadastrar-maquina.html" class="btn-cadastrar-maquina">
                        Cadastrar Máquina
                    </a> 
                    <button class="btn-notificacao">
                    </button>
                    <a href="conta.html" class="btn-conta">
                        <div class="icon-user2"></div>
                    </a>

                        </div>
                    </div>
                    <!-- Fim Cabeçalho -->
                    <div class="box-dashboard">

                        <div class="box-notificacao">

                            <!-- Topo  quadro de monitoramento -->
                            <div class="topo-notificacao">
                                <div class="box-id">
                                    <p>HOSTNAME</p>
                                </div>
                                <div class="box-nome">
                                    <p>IDENTIFICADOR</p>
                                </div>
                                <div class="box-uptime">
                                    <p>UPTIME</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>ULTIMA OCORRÊNCIA</p>
                                </div>
                                <div class="box-rack">
                                    <p>USO DO RACK</p>
                                </div>
                                <div class="box-uptime">
                                    <p>STATUS</p>
                                </div>
                            </div>

                            <!-- Linha 1-->
                            <div class="line-notifica1">
                                <div class="box-id">
                                    <p>0001</p>
                                </div>
                                <div class="box-nome">
                                    <p>PROD-WEB-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>5 anos</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>Sem ocorrências</p>
                                </div>
                                <div class="box-rack">
                                    <p>50%</p>
                                </div>
                                <div class="box-status">
                                    <div>Operando</div>
                                </div>
                            </div>

                            <!-- Linha 2-->
                            <div class="line-notifica2">
                                <div class="box-id">
                                    <p>0002</p>
                                </div>
                                <div class="box-nome">
                                    <p>HTML-WEB-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>1 mês</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>09/09/2025</p>
                                </div>
                                <div class="box-rack">
                                    <p>17%</p>
                                </div>
                                <div class="box-status">
                                    <div>Ocioso</div>
                                </div>
                            </div>

                            <!-- Linha 3-->
                            <div class="line-notifica3">
                                <div class="box-id">
                                    <p>0003</p>
                                </div>
                                <div class="box-nome">
                                    <p>DEV-WEB-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>2 semanas</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>07/10/2025</p>
                                </div>
                                <div class="box-rack">
                                    <p>90%</p>
                                </div>
                                <div class="box-status">
                                    <div>Crítico</div>
                                </div>
                            </div>

                            <!-- Linha 4-->
                            <div class="line-notifica4">
                                <div class="box-id">
                                    <p>0004</p>
                                </div>
                                <div class="box-nome">
                                    <p>PROD-DB-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>2 anos</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>21/02/2023</p>
                                </div>
                                <div class="box-rack">
                                    <p>70%</p>
                                </div>
                                <div class="box-status">
                                    <div>Operando</div>
                                </div>
                            </div>

                            <!-- Linha 5-->
                            <div class="line-notifica5">
                                <div class="box-id">
                                    <p>0005</p>
                                </div>
                                <div class="box-nome">
                                    <p>HTML-DB-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>4 dias</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>12/10/2025</p>
                                </div>
                                <div class="box-rack">
                                    <p>20%</p>
                                </div>
                                <div class="box-status">
                                    <div>Ocioso</div>
                                </div>
                            </div>

                            <!-- Linha 6-->
                            <div class="line-notifica6">
                                <div class="box-id">
                                    <p>0006</p>
                                </div>
                                <div class="box-nome">
                                    <p>PROD-APP-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>3 anos</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>Sem ocorrências</p>
                                </div>
                                <div class="box-rack">
                                    <p>60%</p>
                                </div>
                                <div class="box-status">
                                    <div>Operando</div>
                                </div>
                            </div>

                            <!-- Linha 7-->
                            <div class="line-notifica7">
                                <div class="box-id">
                                    <p>0007</p>
                                </div>
                                <div class="box-nome">
                                    <p>PROD-WEB-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>Inativo</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>06/06/2024</p>
                                </div>
                                <div class="box-rack">
                                    <p>0%</p>
                                </div>
                                <div class="box-status">
                                    <div>Inoperante</div>
                                </div>
                            </div>

                            <!-- Linha 8-->
                            <div class="line-notifica8">
                                <div class="box-id">
                                    <p>0008</p>
                                </div>
                                <div class="box-nome">
                                    <p>DEV-DB-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>12 horas</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>27/10/2025</p>
                                </div>
                                <div class="box-rack">
                                    <p>75%</p>
                                </div>
                                <div class="box-status">
                                    <div>Alerta</div>
                                </div>
                            </div>

                            <!-- Linha 9-->
                            <div class="line-notifica-final">
                                <div class="box-id">
                                    <p>0009</p>
                                </div>
                                <div class="box-nome">
                                    <p>DEV-APP-01</p>
                                </div>
                                <div class="box-uptime">
                                    <p>25 minutos</p>
                                </div>
                                <div class="box-ocorrencia">
                                    <p>16/07/2025</p>
                                </div>
                                <div class="box-rack">
                                    <p>18%</p>
                                </div>
                                <div class="box-status">
                                    <div>Ocioso</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="modalNotificacoes" tabindex="-1"
                        aria-labelledby="modalNotificacoesLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content border-success">
                                <div class="modal-header bg-success text-white">
                                    <h5 class="modal-title" id="modalNotificacoesLabel">Últimos Alertas</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                        aria-label="Fechar"></button>
                                </div>
                                <div class="modal-body">
                                    <div id="alertasContainer">
                                        <p class="text-center text-muted">Carregando alertas...</p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-success"
                                        data-bs-dismiss="modal">Fechar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
</body>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const btnNotificacao = document.querySelector('.btn-notificacao');
    btnNotificacao.addEventListener('click', () => {
        const modal = new bootstrap.Modal(document.getElementById('modalNotificacoes'));
        modal.show();
        carregarAlertas()
    });


    function filtrarCadastroMaquina() {
    const fktipoUsuario = sessionStorage.getItem("FK_TIPO_USUARIO");
    btnCadsatrarMaquina = document.getElementById("btnCadsatrarMaquina")

    if(fktipoUsuario == 1) {
        btnCadsatrarMaquina.style.display = 'none'
    }
    }



    async function carregarAlertas() {
        const alertasExibir = document.getElementById('alertasContainer');
        alertasExibir.innerHTML = `<p class="text-center text-muted">Carregando alertas...</p>`;

        try {
            const response = await fetch(`/usuarios/puxarAlerta`, { cache: 'no-store' });

            if (!response.ok) {
                throw new Error('Erro ao buscar alertas');
            }
            
            const alertas = await response.json();

            if (alertas.length == 0) {
                alertasExibir.innerHTML = `<p class="text-center text-muted">Nenhum alerta recente.</p>`;
                return;
            }

            alertasExibir.innerHTML = '';

            for (let index = 0; index < alertas.length; index++) {
                var alerta = alertas[index];

                var div = document.createElement('div');

                var tipoClasse = 'alert-secondary';

                if (alerta.estado == 'CRITICO') {
                    tipoClasse = 'alert-danger';
                } else if (alerta.estado == 'ALERTA') {
                    tipoClasse = 'alert-warning';
                } else if (alerta.estado == 'NORMAL') {
                    tipoClasse = 'alert-success';   
                } 

                div.className = `alert ${tipoClasse} mb-2`;
                div.role = 'alert';

                div.innerHTML = `
                <strong>Identificador da máquina: </strong> <small> ${alerta.identificador || 'Maquina desconhecida'} </small> <br>
                <strong>${alerta.componenteNome || 'Componente desconhecido'}:</strong> ${alerta.captura || 'Sem captura.'} <br>
                <strong> Estado: </strong> <small> ${alerta.estado || 'DESCONHECIDO'} </small>
                <br><small>${new Date(alerta.dtHora).toLocaleString()}</small>
            `;
                alertasExibir.appendChild(div);
            }

        } catch (error) {
            console.error('Erro ao carregar alertas:', error);
            alertasExibir.innerHTML = `<p class="text-danger text-center">Erro ao carregar alertas.</p>`;
        }
    }




</script>